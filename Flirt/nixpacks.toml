# Nixpacks configuration for Flirt Hair & Beauty
# Provides build environment, SQLite3 compilation handled by postinstall script

[phases.setup]
nixPkgs = ['nodejs_22', 'python311', 'python311Packages.setuptools', 'pkg-config', 'sqlite', 'gcc', 'gnumake']

[phases.install]
cmds = ['npm ci']

[phases.build]
cmds = [
  'echo "=== Build Phase Diagnostics ==="',
  'echo "ğŸ Verifying Python 3.11 distutils availability..."',
  'python3.11 -c "import distutils; print(\"âœ… distutils available\")"',
  'echo "ğŸ”§ Rebuilding SQLite3 for Linux platform..."',
  'export PYTHON=python3.11',
  'npm config set python python3.11',
  'npm rebuild sqlite3 --build-from-source',
  'echo "âœ… SQLite3 build complete - SQLite-only configuration"'
]

[start]
cmd = 'npm start'