# Nixpacks configuration for Flirt Hair & Beauty
# Provides build environment, SQLite3 compilation handled by postinstall script

[phases.setup]
nixPkgs = ['nodejs_22', 'python3', 'pkg-config', 'sqlite', 'gcc', 'gnumake']

[phases.install]
cmds = ['npm ci']

[phases.build]
cmds = [
  'echo "=== Build Phase Diagnostics ==="',
  'ls -la data/ || echo "âŒ Data directory not found"',
  'ls -la data/*.json 2>/dev/null | wc -l | xargs -I {} echo "ğŸ“ Found {} JSON files"',
  'echo "ğŸ”§ Rebuilding SQLite3 for Linux platform..."',
  'npm rebuild sqlite3 --build-from-source || echo "âš ï¸ SQLite3 rebuild failed - will use JSON fallback"',
  'echo "âœ… Build complete"'
]

[start]
cmd = 'npm start'